<% content_for :title do %>
  <title><%= @spot.name %> | 自転車空気入れマップ</title>
<% end %>

<div class="container">
  <div class="row">
    <div class="col-md-10 col-lg-8 mx-auto">
      <div class="row">
        <h1 class="col-6">施設情報</h1>
        <div class="col-4">
          <p>登録日時：<%= @spot.created_at.strftime('%Y/%m/%d %H:%M') %></p>
        </div>
        <div class="col-2">
          <%= link_to edit_spot_path(@spot) do %>
            <button class="btn btn-primary">編集</button>
          <% end %>
        </div>
      </div>
      <div>
        <p>施設名</p>
        <div class="row">
          <div class="col-10">
            <p><%= @spot.name %></p>
          </div>
          <div class="col-2">
            <%= render partial: 'favorites/favorite_button', locals: { spot: @spot } %>
          </div>
        </div>
      </div>
      <div>
        <p>住所</p>
        <div class="row">
          <p class="col-6"><%= @spot.decorate.full_address %></p>
          <div class="col-6">
            <%= link_to "https://www.google.com/maps/dir/?api=1&destination=#{@spot.decorate.full_address}", target: "_blank" do %>
              <button class="btn btn-primary">地図</button>
            <% end %>
          </div>
        <div>
      </div>
      <div>
        <p>貸出し料金</p>
        <p><%= @spot.fee_i18n %></p>
      </div>
      <div>
        <p>空気入れの動力</p>
        <p><%= @spot.pumps.map(&:usage).join('、') %></p>
      </div>
      <div>
        <p>対応するバルブの形状</p>
        <p><%= @spot.valves.map(&:kind).join('、') %></p>
      </div>
      <div>
        <p>施設の営業時間</p>
        <% if @spot.opening_time.nil? || @spot.closing_time.nil? %>
          <p>未登録</p>
        <% else %>
          <p><%= @spot.opening_time.strftime('%k:%M') %> 〜 <%= @spot.closing_time.strftime('%k:%M') %></p>
        <% end %>
      </div>
      <div>
        <p>コメント</p>
        <% @comments.each do |comment| %>
          <div class="card mb-3">
            <div class="card-body">
              <p class="card-text"><%= comment.content %></p>
              <p class="card-text">
                <%= "#{comment.created_at.strftime('%Y/%m/%d %H:%M')}　#{comment.user&.name || '(Anonymous)'}" %>
              </p>
              <% if logged_in? && (current_user.role == 'admin' || current_user.id == comment.user_id) %>
                <%= link_to comment_path(comment), method: :delete, data: { confirm: '本当に削除してよろしいですか？' } do %>
                  <button class="btn btn-danger">削除</button>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
        <%= paginate @comments, theme: 'bootstrap-5' %>
      </div>
      <div>
        <%= form_with model: @comment, url: spot_comments_path(@spot), local: true do |f| %>
          <%= f.hidden_field :spot_id, value: @spot.id %>
          <div class="mb-3">
            <%= f.text_area :content, class: 'form-control', placeholder: 'コメントを入力してください', required: true %>
          </div>
          <div class="mb-3">
            <%= f.submit t('helpers.submit.post'), class: 'btn btn-primary' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
